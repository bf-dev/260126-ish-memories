Fact Record for Lec04-Tidyverse.pdf

The document is titled Introduction to Data Science and Engineering - The tidyverse. The content is presented by Insung, with materials credited to RB Luo from the School of Computing and Data Science at the University of Hong Kong. Some materials are modified from original versions by Rafael A. Irizarry and retrofitted by Michael Wu. The content is licensed under Creative Commons Attribution-NonCommercial-ShareAlike (CC BY-NC-SA).

Insung illustrates the evolution of R code using ChatGPT prompts regarding COVID-19 trends in the United States. Prompts are dated February 2023, January 2024, and August 2025. The code evolution shows a progression from using base R and early tidyverse functions to more complex scripts utilizing packages like tidyverse, lubridate, scales, and zoo.

Insung defines the tidyverse as a collection of R packages designed for data science that work with a specific data format called tidy. In tidy data, each row represents one observation and each column represents a different variable. The core packages in the tidyverse include ggplot2 for data visualization, dplyr for data wrangling, readr for reading data, tibble for modern data frames, stringr for string manipulation, forcats for dealing with factors, tidyr for data tidying, and purrr for functional programming.

When loading the library using library(tidyverse) in R version 4.2.2, specific package versions attached include ggplot2 3.4.0, tibble 3.1.8, tidyr 1.2.1, readr 2.1.3, purrr 1.0.0, dplyr 1.0.10, stringr 1.5.0, and forcats 0.5.2. Loading this library results in namespace conflicts where dplyr::filter() masks stats::filter() and dplyr::lag() masks stats::lag().

Insung explains data manipulation using the murders dataset from the dslabs package. The mutate function is used to add new columns. For example, a rate column is added by dividing total by population and multiplying by 100,000. Insung notes that dplyr functions look for variables directly within the data frame provided as the first argument, which improves code readability.

The filter function is used for subsetting rows based on conditions, such as selecting states where the murder rate is lower than or equal to 0.71. The select function is used to choose specific columns, such as state, region, and rate.

Piping is introduced using the |> and %>% operators. Piping sends the output of the expression on the left as the first argument to the function on the right. Insung provides a timeline of R code evolution: for loops in 1999, the table function in 2007, the %>% pipe in 2014, and the |> native pipe in 2021. An example shows that 16 |> sqrt() is equivalent to sqrt(16).

The summarize function computes summary statistics. Using the heights dataset, Insung shows how to calculate the average and standard deviation of female heights. A specific statistical caution is provided: rates should not be averaged directly. To calculate the average US murder rate, one should sum the total murders and divide by the sum of the total population before multiplying by 100,000. The correct calculation yields a rate of 3.034555, whereas taking the mean of individual state rates incorrectly yields 2.779125.

Insung demonstrates the use of group_by to stratify data before applying summarize. Using the heights dataset, the female group has a count of 238, an average height of 64.9, and a standard deviation of 3.76. The male group has a count of 812, an average height of 69.3, and a standard deviation of 3.61.

Summary statistics for murder rates by region are provided:
Northeast: minimum 0.320, median 1.80, maximum 3.60, count 9.
South: minimum 1.46, median 3.40, maximum 16.5, count 17.
North Central: minimum 0.595, median 1.97, maximum 5.36, count 12.
West: minimum 0.515, median 1.29, maximum 3.63, count 13.

Sorting is performed using the arrange function. By default, it sorts in ascending order. The desc function can be wrapped around a variable to sort in descending order. Nested sorting allows ordering by one column and then another, such as sorting by region and then by murder rate descendingly. The top_n function extracts the top n records according to a specific column without requiring an explicit sort of the entire table.

Insung introduces the placeholder operator, which is the underscore symbol. In R 4.1.0 and later, it allows the piped object to be passed to a function argument that is not the first one. For example, 2 |> log(8, base = _) results in 3.

The purrr package provides functional programming tools. It contains functions like map, map_dbl, and map_df which are similar to base R's sapply but offer better control over output types. map always returns a list, map_dbl returns a numeric vector, and map_df returns a data frame.

Tidyverse conditionals include case_when and between. case_when is a vectorized version of ifelse that can handle multiple conditions to produce a single categorical variable. For example, it can group states into New England, West Coast, South, or Other based on abbreviations or region names. The between(x, a, b) function is a shortcut for checking if a value x falls within the interval from a to b.